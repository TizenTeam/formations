<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="author" content="Arnaud Tournier"><title>Java EE</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme"><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section><h1>Java EE</h1><p><small>Arnaud Tournier</small></p></section><section><section id="_java_ee"><h2>Java EE</h2><div class="paragraph"><p><strong>Définition</strong>, serveur d&#8217;application.</p></div><div class="paragraph"><p>Plateforme Java Enterprise Edition, sur ensemble de la plateforme standard.</p></div><div class="paragraph"><p>Facilite le développement et le déploiement d&#8217;applications web distribuées exécutées au sein des serveurs d&#8217;application.</p></div></section><section id="_quelques_implémentations"><h2>Quelques implémentations</h2><div class="paragraph"><p>JavaEE est une norme, il faut choisir l&#8217;implémentation : Tomcat, JBoss, Glassfish, &#8230;&#8203;</p></div>
<div class="paragraph"><p>Application divisées en couches, souvent trois (presentation, business, data).</p></div>
<div class="paragraph"><p>En pratique on a des pages htmls + servlets + jsp en frontal et ejb dans les couches internes (métier, processus et données).</p></div></section><section id="_structure_d_une_application_java_ee"><h2>Structure d&#8217;une application Java EE</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>/
|- fichiers publiques **.html**, **.jsp**, **.css**, **.js**, ...
|- WEB-INF/ (_cachés à l'utilisateur_)
  |- classes
    |- fichiers **.class**
  |- lib
    |- fichiers **.jar**
  |- **web.xml** : C'est un fichier de configuration de l'application</code></pre></div></div></section></section>
<section id="_développement_avec_eclipse"><h2>Développement avec Eclipse</h2><div class="paragraph"><p>Installation de Tomcat, déclaration dans Eclipse, création d&#8217;un projet Dynamic Web Application et du serveur dans Eclipse.</p></div>
<div class="paragraph"><p>Démarrage d&#8217;une application avec un fichier index.html dedans.</p></div></section>
<section id="_http"><h2>HTTP</h2><div class="paragraph"><p>Rappels HTTP, requête, méthode (GET, POST), headers, cookies.</p></div></section>
<section><section id="_servlet"><h2>Servlet</h2><div class="paragraph"><p>Une classe qui traite les requêtes HTTP.</p></div></section><section id="_mise_en_place"><h2>Mise en place</h2><div class="paragraph"><p>Une servlet est une simple classe Java&#8230;&#8203;</p></div>
<div class="ulist"><ul><li><p>Elle hérite de <code>javax.servlet.http.HttpServlet</code>,</p></li><li><p>On implémente une des méthodes choisies <code>doGet</code>, <code>doPost</code> (l&#8217;implémentation par défaut renvoie une page 404).</p></li><li><p>On indique au serveur quels sont l(es) URL(s) traitées par la servlet. Ceci se fait dans le fichier <code>web.xml</code> ou par annotation.</p></li></ul></div></section><section id="_httpservletrequest"><h2>HttpServletRequest</h2><div class="paragraph"><p>Représente la requête</p></div>
<div class="paragraph"><p>Paramètres, cookies</p></div>
<div class="paragraph"><p>Attributs&#8230;&#8203;</p></div></section><section id="_httpservletresponse"><h2>HttpServletResponse</h2><div class="paragraph"><p>Représente la réponse.</p></div></section><section id="_cycle_de_vie"><h2>Cycle de vie</h2><div class="paragraph"><p>Le cycle de vie est géré par le serveur d&#8217;application (<em>d&#8217;où son nom</em>).</p></div>
<div class="paragraph"><p>Celui-ci <em>crée</em> et <em>détruit</em> des instances de la classe.</p></div></section><section id="_exemple"><h2>Exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>class MaServlet extends HttpServlet
{
	protected void doGet( HttpServletRequest r, HttpServletResponse re )
	{
		re.setContentType( "text/html; charset=utf8" );
		re.getWriter().print( "Hello world !" );
	}
}</code></pre></div></div></section></section>
<section><section id="_jsp"><h2>JSP</h2></section><section id="_définition"><h2>Définition</h2><div class="paragraph"><p>L&#8217;écriture de la vue (en HTML) est <em>pénible</em> dans un fichier Java. Les <code>JSP</code> permet au contraire d&#8217;écrire en HTML et d&#8217;injecter du Java.</p></div></section><section id="_fonctionnement"><h2>Fonctionnement</h2><div class="paragraph"><p>Vous écrivez des fichiers <code>.jsp</code>.</p></div>
<div class="paragraph"><p>Ces fichiers sont compilés vers des servlets Java.</p></div>
<div class="paragraph"><p>La servlet est accessible à l&#8217;URL correspondant au nom du fichier JSP (sauf quand il est dans <code>WEB-INF</code>).</p></div>
<div class="paragraph"><p>Les variables <code>request</code>, <code>response</code>, &#8230;&#8203; sont accessibles.</p></div></section><section id="_exercice"><h2>Exercice</h2><div class="paragraph"><p>Faire une page de login.</p></div>
<div class="admonitionblock note"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Pour l&#8217;UTF-8, mettre :</td></tr></table></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>&lt;%@ page pageEncoding="UTF-8" %&gt;</code></pre></div></div>
<div class="paragraph"><p>Executer du code : <code>&lt;% &#8230;&#8203; %&gt;</code></p></div>
<div class="paragraph"><p>Faire un echo : <code>&lt;%= &#8230;&#8203; %&gt;</code></p></div>
<div class="paragraph"><p>Commentaires : <code>&lt;%-- &#8230;&#8203; --%&gt;</code></p></div>
<div class="paragraph"><p>Directive : <code>&lt;%@ page import="package.class"%&gt;</code>, &#8230;&#8203;</p></div></section><section id="_formulaires"><h2>Formulaires</h2><div class="paragraph"><p>L&#8217;envoi de données au moment de la requête se fait grâce aux formulaires HTML.</p></div>
<div class="paragraph"><p>Les valeurs des formulaires sont récupérées grâce à la méthode <code>getParameter( String name )</code> de la classe <code>HttpServletRequest</code>.</p></div></section><section id="_les_jstl"><h2>Les JSTL</h2><div class="paragraph"><p>Il est possible d&#8217;enrichir le <em>vocabulaire</em> des balises utilisables dans un ficher JSP.</p></div>
<div class="paragraph"><p>Cette fonctionnalité est fournie par les <em>tag lib</em> JSTL.</p></div>
<div class="paragraph"><p><a href="https://openclassrooms.com/courses/creez-votre-application-web-avec-java-ee/objectifs-et-configuration">OpenClassRooms</a></p></div></section><section id="_importation_d_une_tag_lib"><h2>Importation d&#8217;une tag lib</h2><div class="paragraph"><p><em>Au préalable, il faut avoir le jar <code>jstl-1.2.jar</code> dans le projet</em>.</p></div>
<div class="paragraph"><p>Importation dans une JSP :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;</code></pre></div></div>
<div class="paragraph"><p>Ceci définit le <em>namespace</em> XML <code>c</code>.</p></div></section><section id="_jstl_exemple_1"><h2>JSTL Exemple 1</h2><div class="paragraph"><p>Ceci est l&#8217;équivalent de la directive <code>&lt;%@ include file="&#8230;&#8203;" %&gt;</code> :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>&lt;jsp:include page="&lt;%= jspPageName %&gt;" /&gt;</code></pre></div></div></section><section id="_jstl_exemple_2"><h2>JSTL Exemple 2</h2><div class="paragraph"><p>Nous souhaitons réécrire le code suivant :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="jsp language-jsp">&lt;ul&gt;
&lt;% for( int i = 0; i &lt;= 7; i++ ) { %&gt;
	&lt;li&gt;&lt;%= i %&gt;&lt;/li&gt;
&lt;% } %&gt;
&lt;/ul&gt;</code></pre></div></div></section><section id="_jstl_exemple_2_2"><h2>JSTL Exemple 2</h2><div class="paragraph"><p>Voici l&#8217;équivalent avec la JSTL :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="jsp language-jsp">&lt;ul&gt;
&lt;c:forEach var="i" begin="0" end="7" step="1"&gt; <b>(1)</b>
  &lt;li&gt;${i}&lt;/li&gt; <b>(2)</b>
&lt;/c:forEach&gt;
&lt;/ul&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>le noeud <code>forEach</code> crée une variable EL <code>i</code>.</p></li><li><p>la variable <code>i</code> est utilisée dans des expressions EL.</p></li></ol></div></section><section id="_jstl_exemple_3"><h2>JSTL Exemple 3</h2><div class="paragraph"><p>Code sans JSTL :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="jsp language-jsp">&lt;ul&gt;
&lt;% for( User user : users ) { %&gt;
	&lt;li&gt;
		&lt;%= user.getName() %&gt;
		&lt;%= user.getAge() %&gt;
	&lt;/li&gt;
&lt;% } %&gt;
&lt;/ul&gt;</code></pre></div></div></section><section id="_jstl_exemple_4"><h2>JSTL Exemple 4</h2><div class="paragraph"><p>Equivalent JSTL :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="jsp language-jsp">&lt;ul&gt;
&lt;c:forEach var="user" items="${users}"&gt; <b>(1)</b>
  &lt;li&gt;${user.name} ${user.age}&lt;/li&gt; <b>(2)</b>
&lt;/c:forEach&gt;
&lt;/ul&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p><strong>ATTENTION</strong> la variable <code>users</code> doit être disponible</p></li><li><p>Les getters <code>getName()</code> et <code>getAge()</code> suivent la convention java bean.</p></li></ol></div></section><section id="_expression_language"><h2>Expression Language</h2><div class="paragraph"><p><a href="https://openclassrooms.com/courses/creez-votre-application-web-avec-java-ee/la-technologie-jsp-2-2">OpenClassRooms</a>.</p></div>
<div class="paragraph"><p>Quelques éléments du langage :</p></div>
<div class="ulist"><ul><li><p><code>${ expression }</code> : <em>expression</em> va être interprêtée&#8230;&#8203;</p></li><li><p><code>${ true &amp;&amp; true }</code> : &#8230;&#8203;</p></li><li><p><code>${ 10 mod 4 }</code> : &#8230;&#8203;</p></li><li><p><code>${ requestScope['nom'] }</code> : request.getAttribute( "nom" )</p></li><li><p><code>${ sessionScope['nom'] }</code> : session.getAttribute( "nom" )</p></li><li><p><code>${ param['id'] }</code> : request.getParameter( "id" )</p></li></ul></div></section><section id="_el_exemple"><h2>EL exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code>&lt;%
List&lt;String&gt; legumes = new ArrayList&lt;String&gt;();
legumes.add( ... );
request.setAttribute( "legumes" , legumes );
%&gt;

${ legumes.get(1) }
${ legumes[1] }
${ legumes["1"] }</code></pre></div></div></section><section id="_variables_pour_jstl"><h2>Variables pour JSTL</h2><div class="paragraph"><p>Dans une expression EL, on peut utiliser :</p></div>
<div class="ulist"><ul><li><p>les variables issues des boucles <code>&lt;c:foreach&gt;</code>,</p></li><li><p>les variables passées depuis java :</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>pageContext.setAttribute( "users", users );</code></pre></div></div></section><section id="_mvc_etc"><h2>MVC etc</h2><div class="paragraph"><p>On va mettre en place un <em>pattern</em> qui va nous permettre de séparer :</p></div>
<div class="ulist"><ul><li><p>données et traitement (en Java pur),</p></li><li><p>production de documents (en HTML presque pur).</p></li></ul></div>
<div class="paragraph"><p><em>Ceci est réalisé en faisant transiter des informations entre une
servlet java et une vue JSP.</em></p></div></section><section id="_délégation_1"><h2>Délégation 1</h2><div class="paragraph"><p>Délégation à partir d&#8217;une servlet :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>void doGet( HttpServletRequest request, HttpServletResponse response )
{
	this.getServletContext()
		.getRequestDispatcher( "/WEB-INF/test.jsp" )
		.forward( request, response );
}</code></pre></div></div></section><section id="_délégation_2"><h2>Délégation 2</h2><div class="paragraph"><p>Transmission d&#8217;information. Dans la servlet :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">request.setAttribute( "test", message );</code></pre></div></div>
<div class="paragraph"><p>Dans la JSP, on écrira :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="jsp language-jsp">&lt;% String attribut = (String) request.getAttribute("test"); %&gt;

ou en EL : ${test}</code></pre></div></div></section><section id="_scope_1"><h2>Scope 1</h2><div class="paragraph"><p>Lorsqu&#8217;on développe une application, les objets qui représentent les données peuvent avoir différentes portées et durée de vie :</p></div>
<div class="ulist"><ul><li><p>La durée de l&#8217;application (liste des users, &#8230;&#8203;),</p></li><li><p>Propre à connexion d&#8217;un utilisateur (login, panier),</p></li><li><p>Le temps d&#8217;une requête (paramètre HTTP),</p></li><li><p>Certaines variables (JSTL) ne vivent que pendant le rendu d&#8217;une page.</p></li></ul></div></section><section id="_scope_2"><h2>Scope 2</h2><div class="paragraph"><p>Java EE définit quatre <em>scopes</em> (portées ou cycles de vie) pour les objets :</p></div>
<div class="paragraph"><p><code>application</code>, <code>session</code>, <code>request</code> et <code>page</code>.</p></div>
<div class="paragraph"><p>Ceux-ci sont implémentés grâce aux attributs de requête, de session, et de contexte applicatif.</p></div></section><section id="_scope"><h2>Scope</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Portée</th><th class="tableblock halign-left valign-top">Servlet</th><th class="tableblock halign-left valign-top">EL</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>application</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>getServletContext()</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>applicationScope[]</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>session</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>request.getSession()</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessionScope[]</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>request</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>request</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestScope[]</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>page</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>pageScope[]</code></p></td></tr></tbody></table></section><section id="_filtres"><h2>Filtres</h2><div class="paragraph"><p>Il est possible d&#8217;appliquer un traitement sur les requêtes en amont de celui-ci effectué par les Servlets. Ceci permet d&#8217;exécuter un traitement générique indépendamment de l&#8217;url demandée par l&#8217;utilisateur.</p></div>
<div class="paragraph"><p>Le filtre peut alors soit laisser le traitement de la requête se poursuivre, soit effectuer le traitement de son choix, ou même émettre une réponse HTTP à la place de la servlet qui devait être déclenchée pour traiter la requête.</p></div>
<div class="paragraph"><p>Ceci est particulièrement adapté aux problématiques transverses comme la sécurité.</p></div></section><section id="_filtres_utilisation"><h2>Filtres utilisation</h2><div class="ulist"><ul><li><p>On déclare une classe qui implémente l&#8217;interface <code>javax.servlet.Filter</code>.</p></li><li><p>On déclare les urls sur lesquelles le filtre est actif avec l&#8217;annotation <code>@WebFilter</code></p></li></ul></div></section><section id="_exemple_2"><h2>Exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">@WebFilter( "/*" )
public class SecurityFilter implements Filter
{
	public void init( FilterConfig fConfig ) throws ServletException
	{
		// initialisation si besoin
	}

	public void doFilter( ServletRequest request, ServletResponse response,
			FilterChain chain )
			throws IOException, ServletException
	{
		// traitement du filtre

		// passage de la requête au filtre ou servlet suivant
		if( condition )
			chain.doFilter( request, response );
		else
			response.sendRedirect( ... ); // par exemple
	}

	public void destroy()
	{
		// nettoyage des resources si besoin
	}
}</code></pre></div></div></section><section id="_sécuriser_une_appli_avec_des_filtres"><h2>Sécuriser une appli avec des filtres</h2><div class="paragraph"><p>Une utilisation classique des filtres est la sécurisation d&#8217;une application.</p></div>
<div class="ulist"><ul><li><p>On ne va permettre l&#8217;accès aux resources qu&#8217;à la condition que l&#8217;utilisateur soit connecté.</p></li><li><p>On considère que certaines URLs sont à protéger, et certaines pas.</p></li><li><p>Le filtre vérifie le droit d&#8217;accès à la resource demandée et en fonction poursuit le traitement de la requête ou pas.</p></li></ul></div></section><section id="_filtre_avantages"><h2>Filtre - Avantages</h2><div class="paragraph"><p>Un filtre permet d&#8217;effectuer un traitement en amont des traitements métiers spécifiques des Servlet.</p></div>
<div class="paragraph"><p>C&#8217;est donc un bon moyen de s&#8217;assurer qu&#8217;un traitement sera fait quoiqu&#8217;il arrive (ajout de servlet, modification du code, etc&#8230;&#8203;).</p></div></section></section>
<section><section id="_javabean"><h2>JavaBean</h2><div class="paragraph"><p>Une convention pour exprimer la notion de <em>propriété</em>. En écriture et/ou lecture.</p></div><div class="paragraph"><p>Exemple, la propriété <code>Longueur</code> :</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">int getLongueur() { ... }
void setLongueur( int valeur ) { ... }</code></pre></div></div><div class="paragraph"><p>Il peut y avoir une notion d&#8217;abonnement (pattern <em>Observer</em>).</p></div></section><section id="_les_opérations_crud"><h2>Les opérations CRUD</h2><div class="paragraph"><p>En exercice, implémenter sur un type de données :</p></div>
<div class="ulist"><ul><li><p>l&#8217;affichage (<strong>D</strong>isplay),</p></li><li><p>la création de nouveaux éléments (<strong>C</strong>reate),</p></li><li><p>la suppression d&#8217;éléments (<strong>R</strong>emove),</p></li><li><p>la modification d&#8217;éléments (<strong>U</strong>pdate).</p></li></ul></div></section></section>
<section><section id="_jsf"><h2>JSF</h2></section><section id="_introduction"><h2>Introduction</h2><div class="paragraph"><p>C&#8217;est un framework MVC pour simplifier l&#8217;écriture d&#8217;interface graphiques Web.</p></div>
<div class="paragraph"><p>Fonctionne au dessus de l&#8217;api Servlet. Stable et utilisable depuis la version 2.0 en 2009.</p></div></section><section id="_facesservlet"><h2>FacesServlet</h2><div class="paragraph"><p>Une seule servlet prend en charge toutes les requêtes et maintient l&#8217;état de la vue de <em>chaque</em> client.</p></div>
<div class="paragraph"><p><code>javax.faces.webapp.FacesServlet</code></p></div></section><section id="_facelet"><h2>Facelet</h2><div class="paragraph"><p>La programmation des vues repose sur <em>Facelet</em>, description XML des composants de la vue.</p></div>
<div class="paragraph"><p>Fichiers <code>*.xhtml</code></p></div></section><section id="_controlleur"><h2>Controlleur</h2><div class="paragraph"><p>La programmation des actions (<em>controlleur</em>) s&#8217;écrit dans des <em>Java Beans</em>.</p></div>
<div class="paragraph"><p><code>@ManagedBean</code>, <code>@RequestScoped</code>, <code>@ViewScoped</code>, <code>@SessionScoped</code>, <code>@ApplicationScoped</code>, <code>@CustomScope</code> et <code>@NoneScoped</code>&#8230;&#8203;</p></div></section><section id="_modèle"><h2>Modèle</h2><div class="paragraph"><p>Les données attachées aux échanges HTTP sont stockées dans des <em>Java Beans</em> attachés aux différents scopes.</p></div></section><section id="_avantage"><h2>Avantage</h2><div class="paragraph"><p>Facilite la gestion conversationnelle grâce au modèle par composant.</p></div>
<div class="paragraph"><p>Gère par ex. état des vues, maj des modèles, invocation des actions métiers, génération de la réponse, évènements, validation, internationnalisation&#8230;&#8203;</p></div></section><section id="_contrepartie"><h2>Contrepartie</h2><div class="paragraph"><p>On ne maîtrise pas vraiment le HTML généré car la génération de celui-ci est encapsulée dans le code des composants.</p></div></section><section id="_structure_d_une_application_jsf"><h2>Structure d&#8217;une application JSF</h2><div class="ulist"><ul><li><p>Vue : Facelet (un fichier <strong>xhtml</strong>),</p></li><li><p>Modèle : entité JPA ou JavaBean,</p></li><li><p>Controlleur : des `@ManagedBean`s</p></li></ul></div>
<div class="paragraph"><p>Configuration en plus de <code>web.xml</code> dans <code>faces-config.xml</code>.</p></div></section><section id="_les_fichiers_facelet"><h2>Les fichiers Facelet</h2><div class="paragraph"><p>Ce ne sont que des fichiers XHTML (HTML conforme au XML). On utilise les extensions : <strong>.jsf</strong> ou <strong>.xhtml</strong> ou <strong>.faces</strong>.</p></div>
<div class="paragraph"><p>Références des balises JSF : <a href="http://docs.oracle.com/javaee/6/javaserverfaces/2.1/docs/vdldocs/facelets/">ici</a>, <a href="http://www.jsftoolbox.com/documentation/help/12-TagReference/index.jsf">ici</a> et sur <a href="http://stackoverflow.com/tags/jsf/info">stack overflow</a>.</p></div></section><section id="_exemple_3"><h2>Exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="xml language-xml">&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"
	   xmlns:f="http://java.sun.com/jsf/core"
	   xmlns:h="http://java.sun.com/jsf/html"&gt;
	&lt;h:head&gt;
		&lt;title&gt;Bienvenue&lt;/title&gt;
		&lt;h:outputStylesheet library="default" name="cartes.css"&gt;&lt;/h:outputStylesheet&gt;
	&lt;/h:head&gt;
	&lt;h:body&gt;
		&lt;h:form&gt;
			&lt;h:inputText value="#{utilisateur.nom}" /&gt;
			&lt;h:commandButton value="Valider" action="bienvenue" /&gt;
		&lt;/h:form&gt;
	&lt;/h:body&gt;
&lt;/html&gt;</code></pre></div></div></section><section id="_expression_language_pour_jsf"><h2>Expression Language pour JSF</h2><div class="paragraph"><p>L&#8217;évolution technique d&#8217;expression language fait que pour JSF, on utilise la syntaxe du type :</p></div>
<div class="literalblock"><div class="content"><pre>#{inscrireBean.utilisateur.motDePasse}</pre></div></div>
<div class="paragraph"><p>On voit donc que <code>$</code> est remplacé par <code>#</code>. Ceci correspond au fait que l&#8217;expression language pour JSF permet d&#8217;appeler des <strong>setters</strong> sur les java beans, ce qui n&#8217;est pas permis avec <code>$</code>.</p></div>
<div class="paragraph"><p>Depuis Java EE 6, expression language a été unifié et il est maintenant possible d&#8217;utiliser <code>#</code> dans les JSP.</p></div></section><section id="_les_6_étapes_du_traitement_d_une_requête_1_2"><h2>Les 6 étapes du traitement d&#8217;une requête (1/2)</h2><div class="ulist"><ul><li><p><strong>Restauration de la vue</strong> : si c&#8217;est un premier accès JSP crée une donnée de vue (l&#8217;arbre des composants) dans <code>FacesContext</code>. Sinon JSF recharge simplement les données de la vue.</p></li><li><p><strong>Application des paramètres</strong> de la requête : JSF fait automatiquement le lien entre les paramètres présents dans la requête et les champs du modèle à modifier.</p></li><li><p><strong>Validation des données</strong> : si la validation échoue, on passe directement à la dernière étape.</p></li></ul></div></section><section id="_les_6_étapes_du_traitement_d_une_requête_2_2"><h2>Les 6 étapes du traitement d&#8217;une requête (2/2)</h2><div class="ulist"><ul><li><p><strong>Mise à jour du modèle</strong> : si la validation s&#8217;est bien déroulée, cette étape consiste à mettre à jour les données du modèle avec les données validées.</p></li><li><p><strong>Appel au code métier</strong> de l&#8217;application : les actions déclarées dans les formulaires sont exécutées, sous la forme d&#8217;appels aux méthodes des Beans.</p></li><li><p><strong>Rendu de la réponse</strong> : l&#8217;arbre des composants est appelé afin de générer le HTML résultat. Il est mémorisé pour la prochaine <em>Restauration de vue</em>.</p></li></ul></div></section><section id="_configuration"><h2>Configuration</h2><div class="paragraph"><p>Dans <code>web.xml</code> on ajoute :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="xml language-xml">&lt;context-param&gt;
	&lt;!-- autres noms possibles : STATE_SAVING_METHOD, INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL ... --&gt;
	&lt;param-name&gt;javax.faces.PROJECT_STAGE&lt;/param-name&gt;
	&lt;param-value&gt;Development&lt;/param-value&gt;
&lt;/context-param&gt;

&lt;servlet&gt;
	&lt;servlet-name&gt;FacesServlet&lt;/servlet-name&gt;
	&lt;servlet-class&gt;javax.faces.webapp.FacesServlet&lt;/servlet-class&gt;
	&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;FacesServlet&lt;/servlet-name&gt;
	&lt;url-pattern&gt;*.xhtml&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</code></pre></div></div></section><section id="_tutoriel"><h2>Tutoriel</h2><div class="paragraph"><p><a href="https://openclassrooms.com/courses/creez-votre-application-web-avec-java-ee/premiers-pas-avec-jsf" class="bare">https://openclassrooms.com/courses/creez-votre-application-web-avec-java-ee/premiers-pas-avec-jsf</a></p></div></section><section id="_gestion_de_formulaires"><h2>Gestion de formulaires</h2><div class="paragraph"><p><a href="https://openclassrooms.com/courses/creez-votre-application-web-avec-java-ee/la-gestion-d-un-formulaire-avec-jsf" class="bare">https://openclassrooms.com/courses/creez-votre-application-web-avec-java-ee/la-gestion-d-un-formulaire-avec-jsf</a></p></div></section></section>
<section><section id="_sgbd_r"><h2>SGBD-R</h2></section><section id="_systèmes_de_gestion_de_base_de_données_relationnelles"><h2>Systèmes de gestion de base de données relationnelles</h2><div class="paragraph"><p>Un outil pour :</p></div>
<div class="ulist"><ul><li><p><strong>structurer</strong>,</p></li><li><p><strong>stocker</strong>,</p></li><li><p><strong>interroger</strong>,</p></li><li><p>et garantir l'<strong>intégrité</strong> des données.</p></li></ul></div></section><section id="_service"><h2>Service</h2><div class="paragraph"><p>Le SGBD est un processus actif sur une machine. Il ouvre des ports de communication.</p></div>
<div class="paragraph"><p>Et les applications s&#8217;y connectent.</p></div></section><section id="_table"><h2>Table</h2><div class="paragraph"><p>Nous stockons les <strong>enregistrements</strong> dans des <strong>tables</strong> possédant une ou plusieurs <strong>colonnes</strong> :</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Nom</th><th class="tableblock halign-left valign-top">Prénom</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Tournier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Arnaud</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Dupont</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Serres</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Mélanie</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Dupont</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jean</p></td></tr></tbody></table></section><section id="_clé"><h2>Clé</h2><div class="paragraph"><p>Les enregistrements sont repérés de façon sûre grâce aux <strong>identifiants</strong> aussi appelés <strong>clés primaire (PK)</strong>.</p></div>
<div class="paragraph"><p>Chaque identifiant est <strong>unique</strong>.</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">ID</th><th class="tableblock halign-left valign-top">Nom</th><th class="tableblock halign-left valign-top">Prénom</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Tournier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Arnaud</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Dupont</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Serres</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Mélanie</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Dupont</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jean</p></td></tr></tbody></table></section><section id="_clé_étrangère"><h2>Clé étrangère</h2><div class="paragraph"><p>Pour relier les enregistrements entre eux, on utilise les <strong>clés étrangères</strong> :</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">ID</th><th class="tableblock halign-left valign-top">Entreprise_ID</th><th class="tableblock halign-left valign-top">Nom</th><th class="tableblock halign-left valign-top">Prénom</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">44</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Tournier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Arnaud</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Dupont</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Jean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">44</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Serres</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Mélanie</p></td></tr></tbody></table></section><section id="_ddl"><h2>DDL</h2><div class="paragraph"><p>Langage permettant de définir la structure des données dans la base de données.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">CREATE TABLE IF NOT EXISTS `personne` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nom` text COLLATE utf8_bin NOT NULL,
  `prenom` varchar(50) COLLATE utf8_bin NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin AUTO_INCREMENT=1;</code></pre></div></div></section><section id="_sql"><h2>SQL</h2><div class="paragraph"><p>Langage permettant d&#8217;interroger, de créer, supprimer et manipuler les données, en fonction de la structure définie.</p></div>
<div class="paragraph"><p>Quelques exemples&#8230;&#8203;</p></div></section><section id="_insert"><h2>Insert</h2><div class="paragraph"><p>Insérer un enregistrement dans une table :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">INSERT INTO `personne` (`nom`, `prenom`) VALUES ('Tournier', 'Arnaud');</code></pre></div></div>
<div class="paragraph"><p>Dans cette table, l&#8217;identifiant est généré automatiquement&#8230;&#8203;</p></div></section><section id="_update"><h2>Update</h2><div class="paragraph"><p>Mise à jour d&#8217;un ou des enregistrements :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">UPDATE `personne` SET `nom`="Toto", `prenom`="Titi" WHERE id=1;</code></pre></div></div></section><section id="_delete"><h2>Delete</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">DELETE FROM `personne` WHERE nom LIKE "To%";</code></pre></div></div></section><section id="_select"><h2>Select</h2><div class="paragraph"><p>L&#8217;opération la plus utilisée : pour consulter la base de données</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">SELECT * FROM `personne` WHERE prenom LIKE "a%";</code></pre></div></div></section><section id="_jointure"><h2>Jointure</h2><div class="paragraph"><p>Il est possible de <em>combiner</em> des tables en faisant un select :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">SELECT * FROM `personne` p LEFT JOIN `entreprise` e ON p.entreprise_id=e.id;

SELECT p.id, p.nom, e.nom, e.adresse FROM `personne` p LEFT JOIN `entreprise` e ON p.entreprise_id=e.id;</code></pre></div></div></section><section id="_transactions"><h2>Transactions</h2><div class="paragraph"><p>On souhaite pouvoir exécuter une suite d&#8217;instruction de manière <strong>atomique</strong> et <strong>cohérente</strong> (voir les propriétés <em>ACID</em>).</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql">START TRANSACTION;
COMMIT; // on valide ou...
ROLLBACK; // on annule</code></pre></div></div>
<div class="paragraph"><p><em>Interblocage ?</em></p></div></section><section id="_bien_plus"><h2>Bien plus&#8230;&#8203;</h2><div class="paragraph"><p>Le langage SQL est extrêmement riche, nous avons à peine gratté la surface&#8230;&#8203;</p></div>
<div class="paragraph"><p>Voici un <a href="http://sql.sh/">cours et tutoriel</a> pour aller plus loin.</p></div></section><section id="_quelques_serveurs_sql"><h2>Quelques serveurs SQL</h2><div class="paragraph"><p>De nombreuses implémentations existent, avec parfois quelques variantes dans le <em>dialecte</em> SQL : MySQL, MariaDB, Oracle, PostgreSQL, Microsoft SQL Server, SQLite, &#8230;&#8203;</p></div></section><section id="_important"><h2>Important !</h2><div class="ulist"><ul><li><p>Un SGBD peut gérer plusieurs <em>bases de données</em>,</p></li><li><p>Une base de données peut contenir plusieurs <em>tables</em>,</p></li><li><p>Une table possède plusieurs <em>colonnes</em>.</p></li><li><p>Les enregistrements sont repérés par leur <em>clé primaire</em>,</p></li><li><p>On référence un enregistrement à partir d&#8217;un autre avec une <em>clé étrangère</em>.</p></li><li><p>SQL garantit la cohérence des données avec les <em>transactions</em>.</p></li></ul></div></section></section>
<section><section id="_jdbc"><h2>JDBC</h2></section><section id="_accès_depuis_un_programme_java"><h2>Accès depuis un programme Java</h2><div class="paragraph"><p>L&#8217;accès le plus bas niveau avec Java se fait à travers le <em>driver JDBC</em> adapté au serveur auquel on se connecte.</p></div></section><section id="_charger_le_driver_adapté"><h2>Charger le driver adapté</h2><div class="paragraph"><p>La classe doit être présente dans le <em>classpath</em>&#8230;&#8203;</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">try
{
	Class.forName( "com.mysql.jdbc.Driver" );
}
catch( ClassNotFoundException e )
{
	...
}</code></pre></div></div></section><section id="_se_connecter_au_serveur_sql"><h2>Se connecter au serveur SQL</h2><div class="paragraph"><p>Il faut connaître l&#8217;URL de connexion&#8230;&#8203;</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">try
{
	Connection conn = DriverManager.getConnection( "jdbc:mysql://localhost:3306/cartes", "root", "password" );
}
catch( SQLException e )
{
	...
}</code></pre></div></div></section><section id="_exécuter_des_requêtes"><h2>Exécuter des requêtes</h2><div class="paragraph"><p>Exemple de <code>SELECT</code> :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">Statement statement = conn.createStatement();
ResultSet rs = statement.executeQuery( "SELECT id, nom, couleur from carte" ); <b>(1)</b>
while( rs.next() )
{
	String id = rs.getString( "id" );
	String nom = rs.getString( "nom" );
	String couleur = rs.getString( "couleur" );

	System.out.printf( "%s %s %s\n", id, nom, couleur );
}</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Il existe aussi <code>executeUpdate()</code> pour les statements SQL modifiant les données en base, et <code>execute()</code> pour le reste (voir la Javadoc)</p></li></ol></div></section><section id="_requête_d_insertion"><h2>Requête d&#8217;insertion</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">String sqlQuery = "INSERT INTO produits (`designation`) "
		+ "VALUES ('" + produit.getDesignation() + "')";

PreparedStatement statement = databaseConnection.prepareStatement( sqlQuery );
int nbEnregistrementInseres = statement.executeUpdate(); <b>(1)</b>
if( nbEnregistrementInseres == 0 )
	throw new RuntimeException( "Aucun enregistrement inséré" );

// Les clés de(s) enregistrement(s) insérés sont obtenus sous la forme d'un `ResultSet` :
ResultSet createdIds = statement.getGeneratedKeys();
if( createdIds.next() )
	produit.setReference( createdIds.getInt( 1 ) );
else
	throw new RuntimeException( "Aucun produit ajouté" );</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Ici on utilise <code>executeUpdate()</code></p></li></ol></div></section><section id="_utilisation_des_paramètres"><h2>Utilisation des paramètres</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">PreparedStatement updateSales = null;

String updateString =
        "update COFFEES set SALES = ? where COF_NAME = ?";

updateSales = con.prepareStatement(updateString);

updateSales.setInt(1, 42);
updateSales.setString(2, "Toto");

updateTotal.executeUpdate();

updateTotal.close();</code></pre></div></div>
<div class="paragraph"><p>Voir <a href="http://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html" class="bare">http://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html</a></p></div></section><section id="_les_transactions"><h2>Les transactions</h2><div class="paragraph"><p>Les instructions de transactions sont accessibles directement en Java :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">// on désactive l'auto-commit
conn.setAutoCommit( false );

// on joue la transaction...
Statement statement = conn.createStatement();
// ...

// on valide la transaction
conn.commit();
// on aurait pu l'annuler avec 'conn.rollback()'</code></pre></div></div></section><section id="_plus_de_jdbc"><h2>Plus de JDBC</h2><div class="paragraph"><p>Pour aller plus loin avec JDBC, consulez la <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/">documentation officielle</a>.</p></div></section></section>
<section><section id="_jdbc_dans_javaee"><h2>JDBC dans JavaEE</h2><div class="paragraph"><p>Lorsque l&#8217;on travaille sur une application Java EE, ce n&#8217;est plus la responsabilité de notre application d&#8217;initialiser le driver MySql.</p></div><div class="paragraph"><p>C&#8217;est le serveur d&#8217;application qui gère le cycle de vie des composants.</p></div></section><section id="_data_source"><h2>Data Source</h2><div class="paragraph"><p>Ce sera le serveur d&#8217;application qui fournira les connexions aux bases de données (<code>DataSource</code>).</p></div>
<div class="paragraph"><p>Votre application demandera au serveur d&#8217;application une référence à une (des) connexion(s) BDD configurées sur celui-ci.</p></div>
<div class="paragraph"><p>La configuration des DataSource se fait au niveau de la configuration du serveur d&#8217;application, et n&#8217;est pas restreint par la norme Java EE (chaque serveur le fait comme il l&#8217;entend).</p></div>
<div class="paragraph"><p>Voici <a href="http://www.albeesonline.com/blog/2008/08/06/creating-and-configuring-a-mysql-datasource-in-glassfish-application-server/">un lien</a> pour configurer GlassFish.</p></div></section><section id="_accès_à_la_datasource"><h2>Accès à la DataSource</h2><div class="paragraph"><p>Dans l&#8217;application, pour utiliser la base de données, il faut demander une connexion au serveur d&#8217;application :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">// contexte JNDI
Context ctx = new InitialContext();

// obtention de la data source
// le nom JNDI dépend de la configuration et du serveur
DataSource ds = (DataSource) ctx.lookup("jdbc/mysqltest");

// a partir de la data source, on obtient une connexion
Connection con = ds.getConnection();</code></pre></div></div></section><section id="_injection_d_une_connexion"><h2>Injection d&#8217;une connexion</h2><div class="paragraph"><p>On peut demander au serveur d&#8217;application, par l&#8217;intermédiaire d&#8217;une annotation, d&#8217;injecter directement dans nos objets une référence à la DataSource :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public class SomeClass {
    @Resource(name="todoListDB")
    private javax.sql.DataSource myDB;

	...
}</code></pre></div></div>
<div class="paragraph"><p>Ensuite, on utilise</p></div></section></section>
<section><section id="_orm"><h2>ORM</h2><div class="paragraph"><p>L&#8217;écriture du code SQL et DDL est fastidieuse et répétitive. Les _ORM_s sont une sur-couche qui permettent un accès au SGBD plus conforme à la vision objet.</p></div><div class="paragraph"><p>L&#8217;ORM prend en charge la communication avec le SGBD et fourni à l&#8217;application une <em>API</em> de plus haut niveau.</p></div></section><section id="_jpa"><h2>JPA</h2><div class="ulist"><ul><li><p>Java Persistence API,</p></li><li><p><a href="https://jcp.org/en/jsr/detail?id=317">JSR 317</a>,</p></li><li><p><em>Entity manager</em> et <em>Entités</em>,</p></li><li><p>langage <em>JPQL</em>&#8230;&#8203;</p></li><li><p>package <code>javax.persistence</code>.</p></li></ul></div>
<div class="paragraph"><p>Lire la spécificaton <a href="http://download.oracle.com/otndocs/jcp/persistence-2_1-fr-eval-spec/index.html">ici</a>.</p></div></section><section id="_fournisseurs"><h2>Fournisseurs</h2><div class="paragraph"><p>Plusieurs implémentations : Hibernate, Toplink, DataNucleus, &#8230;&#8203;</p></div></section><section id="__entity"><h2>@Entity</h2><div class="ulist"><ul><li><p>Classe dont l&#8217;état est sauvegardé dans une <em>table</em>.</p></li><li><p>Chaque instance correspond à un <em>enregistrement</em>.</p></li><li><p>Les attributs correspondent aux colonnes.</p></li><li><p>Les relations sont exprimées avec des annotations (ou xml).</p></li></ul></div></section><section id="__id"><h2>@Id</h2><div class="paragraph"><p>Dénote l&#8217;attribut utilisé comme clé primaire.</p></div>
<div class="paragraph"><p>On précise la stratégie de génération des identifiants.</p></div></section><section id="_exemple_4"><h2>Exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">@Entity
public class Utilisateur
{
	@Id
	@GeneratedValue( strategy = GenerationType.IDENTITY )
	private Integer id;

	@NotNull
	private String nom;

	// méthodes, getters, setters
}</code></pre></div></div></section><section id="__column"><h2>@Column</h2><div class="paragraph"><p>Permet de changer entre autres le nom de la colonne choisi par défaut par JPA.</p></div>
<div class="paragraph"><p>Attributs : <code>name</code>, <code>length</code>, <code>unique</code>, <code>nullable</code>, <code>insertable</code>, <code>updatable</code>, <code>precision</code>, <code>scale</code>, <code>columnDefinition</code>&#8230;&#8203;</p></div></section><section id="__lob"><h2>@Lob</h2><div class="paragraph"><p>L&#8217;annotation <code>@Lob</code> permet de préciser à JPA que la valeur de l&#8217;attribut sera à stocker sous forme binaire dans la table SQL elle-même.</p></div></section><section id="_entity_manager"><h2>Entity Manager</h2><div class="paragraph"><p>Une instance de la classe <code>EntityManager</code> fait le lien entre les données de la base et les objets <em>entités</em>.</p></div>
<div class="paragraph"><p>Celle-ci est fournie par le serveur d&#8217;application, et est connectée directement à la base de donnée configurée dans le serveur.</p></div>
<div class="paragraph"><p>Opérations : <code>persist</code>, <code>merge</code>, <code>remove</code>, <code>find</code>, <code>createQuery</code>&#8230;&#8203;</p></div>
<div class="paragraph"><p>Maintient l&#8217;assertion 1 enregistrement &lt;&#8658; 1 entité.</p></div></section><section id="_persist"><h2>Persist</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public void add( Utilisateur utilisateur )
{
	em.persist( utilisateur );
}</code></pre></div></div>
<div class="paragraph"><p>Rend une entité gérée et persistante. Etat sauvegardé au prochain <em>flush</em> / <em>commit</em>.</p></div></section><section id="_merge"><h2>Merge</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public Utilisateur save( Utilisateur utilisateur )
{
	return em.merge( utilisateur );
}</code></pre></div></div>
<div class="paragraph"><p>Attache l&#8217;entité à l&#8217;entity manager courant. Recopie l&#8217;état de l&#8217;entité en paramètre dans l&#8217;état de l&#8217;entité <em>gérée</em>.</p></div>
<div class="paragraph"><p>Retourne l&#8217;entité associée à l&#8217;entity manager courant.</p></div></section><section id="_find"><h2>Find</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public Utilisateur findById( int id )
{
	return em.find( Utilisateur.class, id );
}</code></pre></div></div>
<div class="paragraph"><p>L&#8217;entité retournée est <em>gérée</em>.</p></div></section><section id="_remove"><h2>Remove</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public void delete( Utilisateur utilisateur )
{
	em.remove( utilisateur );
}</code></pre></div></div>
<div class="paragraph"><p>Rend une entité <em>supprimée</em>. Retirée de la BDD au prochain <em>commit</em> / <em>flush</em>.</p></div></section><section id="_refresh"><h2>Refresh</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">em.refresh( utilisateur );</code></pre></div></div>
<div class="paragraph"><p>Synchronise l&#8217;état de l&#8217;entité avec la base de données. Abandonne modifications en cours.</p></div></section><section id="_detach"><h2>Detach</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">em.detach( utilisateur );</code></pre></div></div>
<div class="paragraph"><p>Détache l&#8217;entité de l&#8217;entity manager. Les modifications faites dessus ne seront donc pas prises en compte au prochain commit.</p></div></section><section id="_jpql"><h2>JPQL</h2><div class="paragraph"><p>Langage inspiré par SQL qui est pensé avec le paradigme objet.</p></div></section><section id="_create_query"><h2>Create Query</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public Utilisateur findByLogin( String login, String motDePasse )
{
	Query query = em.createQuery( "from Utilisateur u where u.login=:login and u.motDePasse=:motDePasse" );

	query.setParameter( "login", login );
	query.setParameter( "motDePasse", motDePasse );

	Utilisateur u = (Utilisateur) query.getSingleResult();
	return u;
}</code></pre></div></div></section><section id="_create_query_2"><h2>Create Query</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public List&lt;Utilisateur&gt; getUtilisateurs()
{
	Query query = em.createQuery( "from Utilisateur" );

	List&lt;Utilisateur&gt; result = (List&lt;Utilisateur&gt;) query.getResultList();

	return result;
}</code></pre></div></div></section><section id="_criteria_api"><h2>Criteria API</h2><div class="paragraph"><p>Il y a aussi une <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjitv.html">API</a> pour éviter le <em>JPQL</em> et construire les requêtes programmatiquement.</p></div></section><section id="_requêtes_nommées"><h2>Requêtes nommées</h2></section><section id="_relations"><h2>Relations</h2><div class="paragraph"><p>JPA gère les relations entre enregistrements et donc entre entités.</p></div>
<div class="paragraph"><p><a href="http://docs.oracle.com/javaee/7/tutorial/persistence-intro001.htm#BNBQA">voir ce site</a></p></div>
<div class="paragraph"><p>Et l&#8217;excellent tuto de José <a href="http://blog.paumard.org/cours/jpa/chap03-entite-relation.html">ici</a></p></div></section><section id="_règles"><h2>Règles</h2><div class="ulist"><ul><li><p>Les relations JPA ne sont possible qu&#8217;entres classes <code>@Entity</code>.</p></li><li><p>Peuvent être <em>unidirectionnelles</em> ou <em>bidirectionnelles</em> (une source, une cible).</p></li><li><p>Dans le cas des relations <code>1:1</code> et <code>n:p</code>, on peut choisir le côté source comme on le souhaite. Dans le cas des relations <code>1:p</code> et <code>n:1</code>, l&#8217;entité du côté <code>1</code> est l&#8217;entité cible.</p></li></ul></div></section><section id="__onetoone"><h2>@OneToOne</h2><div class="paragraph"><p>Exemple : <code>Maire</code> et <code>Commune</code>.</p></div>
<div class="paragraph"><p>Unidirectionnel :</p></div>
<div class="ulist"><ul><li><p>dans <code>Commune</code>, un attribut de <code>Maire maire</code> est annoté avec <code>@OneToOne</code> (colonne <code>maire_id</code> dans la table <code>commune</code>, voir <code>@JoinColumn("name"=&#8230;&#8203;)</code>).</p></li></ul></div>
<div class="paragraph"><p>Bidirectionnel :</p></div>
<div class="ulist"><ul><li><p>dans l&#8217;entité <code>Maire</code>, on peut ajouter <code>@OneToOne</code> avec son attribut <code>mappedBy</code> qui contient le nom de l&#8217;attribut utilisé dans la classe source.</p></li></ul></div></section><section id="__onetomany_et_manytoone"><h2>@OneToMany et @ManyToOne</h2><div class="paragraph"><p><code>@ManyToOne</code> est utilisée côté source et correspond à une clé étrangère vers l&#8217;entité cible.</p></div>
<div class="paragraph"><p>On précise le champ de retour dans l&#8217;attribut <code>mappedBy</code> de l&#8217;annotation <code>@OneToMany</code> dans l&#8217;entité cible.</p></div>
<div class="paragraph"><p>Côté <code>@OneToMany</code>, l&#8217;attribut Java est de type <code>Collection</code> (<code>List</code>, <code>Set</code>, &#8230;&#8203;).</p></div></section><section id="__manytomany"><h2>@ManyToMany</h2><div class="paragraph"><p>Utilise et gère une <em>table de jointure</em>.</p></div>
<div class="paragraph"><p>Les entités source et cible utilisent toutes les deux <code>@ManyToMany</code>.</p></div>
<div class="paragraph"><p>L&#8217;entité cible valorise l&#8217;attribut <code>mappedBy</code> de l&#8217;annotation.</p></div></section><section id="_utilisation_standalone"><h2>Utilisation standalone</h2><div class="paragraph"><p>Il est possible d&#8217;utiliser JPA indépendamment d&#8217;un serveur d&#8217;application Java EE.</p></div></section><section id="_cascade"><h2>Cascade</h2><div class="paragraph"><p>Le comportement cascade consiste à spécifier ce qui se passe pour une entité en relation d&#8217;une entité père (que cette relation soit monovaluée ou multivaluée), lorsque cette entité père subit une des opérations de persistence (DETACH, MERGE, PERSIST, REMOVE, REFRESH).</p></div>
<div class="paragraph"><p>Utilisable dans les annotations <code>@OneToOne</code>, <code>@OneToMany</code> et <code>@ManyToMany</code>.</p></div></section><section id="_orphan_removal"><h2>Orphan removal</h2><div class="paragraph"><p>Lorsqu&#8217;une entité n&#8217;est plus référencée par aucune autre on dit qu&#8217;elle est orpheline.</p></div>
<div class="paragraph"><p>JPA permet de configurer le comportement à avoir lorsqu&#8217;une entité devient orpheline. Positionner <code>orphanRemoval=true</code> sur une relation <code>@OneToOne</code> ou <code>@OneToMany</code> activera l&#8217;effacement des entités orphelines.</p></div></section><section id="_dans_une_application_javaee"><h2>Dans une application JavaEE</h2><div class="paragraph"><p>JPA est totalement intégré au fonctionnement d&#8217;une application Java EE.</p></div>
<div class="paragraph"><p>Plusieurs éléments de configuration sont nécessaires&#8230;&#8203;</p></div></section><section id="_sources_de_données"><h2>Sources de données</h2><div class="paragraph"><p>Les <em>Data source</em> sont configurées dans le serveur d&#8217;application. On y précise le <em>driver</em>, l'<em>url de connexion</em> et les information d'<em>authentification</em>.</p></div>
<div class="paragraph"><p>Chaque implémentation se configure différemment.</p></div></section><section id="_fichier_persistence"><h2>Fichier persistence</h2><div class="paragraph"><p><code>META-INF/persistence.xml</code></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.0" xmlns="http://java.sun.com/xml/ns/persistence"&gt;
	&lt;persistence-unit name="Cartes" transaction-type="JTA"&gt; <b>(1)</b>
		&lt;jta-data-source&gt;CartesDS&lt;/jta-data-source&gt;

		&lt;properties&gt;
			&lt;property name="hibernate.hbm2ddl.auto" value="update" /&gt;
			&lt;property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect" /&gt;
		&lt;/properties&gt;
	&lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre></div></div>
<div class="colist arabic"><ol><li><p>Type de transaction JTA</p></li></ol></div></section><section id="_ejb"><h2>EJB</h2><div class="ulist"><ul><li><p><strong>Composants</strong> logiciels (métier) de base de Java EE.</p></li><li><p>Naturellement <strong>distribué</strong>.</p></li><li><p>Evoluent dans un milieu <strong>transactionnel</strong>.</p></li></ul></div></section><section id="_plusieurs_types"><h2>Plusieurs types</h2><div class="ulist"><ul><li><p><code>@Local</code> ou <code>@Remote</code>,</p></li><li><p><code>@Stateful</code> ou <code>@Stateless</code>,</p></li><li><p>EJB Message.</p></li><li><p>Enregistré dans JNDI.</p></li></ul></div></section><section id="_création_d_un_ejb"><h2>Création d&#8217;un EJB</h2><div class="paragraph"><p>Soit une interface (<code>@Remote</code> ou <code>@Local</code>) et une classe, soit depuis EJB 3 une seule classe :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">// un EJB de session sans état
@Stateless
public class MonEJB {
	// par exemple :
	@PostConstruct
	void onInit() {
	}
}</code></pre></div></div></section><section id="_injection_de_dépendances"><h2>Injection de dépendances</h2><div class="paragraph"><p>Le serveur d&#8217;application peut injecter des composants en utilisant les annotations :</p></div>
<div class="ulist"><ul><li><p><code>@EJB</code> : un autre EJB,</p></li><li><p><code>@Resource</code> : une resource JNDI (EntityManager, UserTransaction, SessionContext, &#8230;&#8203;),</p></li></ul></div></section><section id="_exemple_5"><h2>Exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">@Stateless( mappedName = "MarinService" )
public class MarinServiceImpl implements MarinService {
	@Resource
	private UserTransaction transaction;

	@Resource( mappedName = "jdbc/CartesDS" )
	private DataSource dataSource;

	@PersistenceContext( unitName = "CartesDS" )
	private EntityManager em;

	// ...
}</code></pre></div></div></section><section id="_injection_de_l_unité_de_persistence"><h2>Injection de l&#8217;unité de persistence</h2><div class="paragraph"><p>Au sein d&#8217;un <em>EJB</em>, on peut injecter une instance de l'`EntityManager` :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">@Stateless
public class ProduitDao
{
	@PersistenceContext( name = "SiteDeVente" )
	EntityManager em;

	// ...
	// utilisation de l'EntityManager
}</code></pre></div></div></section><section id="_injection_d_un_ejb_dans_une_servlet"><h2>Injection d&#8217;un EJB dans une Servlet</h2><div class="paragraph"><p>Au sein d&#8217;une servlet, il est possible d&#8217;injecter une instance de l&#8217;EJB :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">@WebServlet( "/youpi" )
public class ProduitsServlet extends HttpServlet
{
	@EJB
	ProduitDao produitDao;

	protected void doGet()
	{
		// utilisation du DAO
	}
}</code></pre></div></div></section><section id="_injection_d_un_ejb_dans_un_bean_jsf"><h2>Injection d&#8217;un EJB dans un bean JSF</h2><div class="paragraph"><p>Au sein d&#8217;une servlet ou d&#8217;un <em>Managed Bean</em>, il est possible d&#8217;injecter une instance de l&#8217;EJB :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">@ManagedBean
@ViewScoped
public class ProduitsBean implements Serializable
{
	@EJB
	ProduitDao produitDao;

	// ...
	// utilisation du DAO
}</code></pre></div></div></section><section id="_gestion_de_la_transaction"><h2>Gestion de la transaction</h2><div class="paragraph"><p>Les méthodes EJB s&#8217;exécutent dans un contexte <em>transactionnel</em>. Une transaction est (toujours) ouverte (automatiquement).</p></div>
<div class="paragraph"><p>Le comportement est modifiable avec <code>@TransactionAttribute</code>.</p></div>
<div class="paragraph"><p>Si une exception surgit hors de la méthode, la transaction est abandonnée (<em>rollback</em>).</p></div></section><section id="_pattern_dao"><h2>Pattern DAO</h2><div class="dlist"><dl><dt class="hdlist1">DAO</dt><dd><p>Data Access Object ayant la responsabilité de fournir les données.
C&#8217;est lui qui accède à l'`EntityManager`.</p></dd></dl></div></section><section id="_architecture_3_tiers"><h2>Architecture 3 tiers</h2><div class="paragraph"><p>C&#8217;est une architecture classque pour les applications d&#8217;entreprise.</p></div>
<div class="ulist"><ul><li><p>Présentation,</p></li><li><p>Métier,</p></li><li><p>Données.</p></li></ul></div>
<div class="paragraph"><p>Les données sont gérées de manière transactionnelle.</p></div>
<div class="paragraph"><p>Cet aspect transactionnel est pris en charge par les EJB.</p></div></section></section>
<section><section id="_tester_son_code"><h2>Tester son code</h2></section><section id="_définition_2"><h2>Définition</h2><div class="paragraph"><p>Code qui exécute un autre code pour valider son comportement et/ou son état.</p></div>
<div class="paragraph"><p>Utilité : validation automatique, détection des régressions, documentation, indication de performance.</p></div>
<div class="paragraph"><p><a href="http://www.vogella.com/tutorials/JUnit/article.html">Introduction aux tests</a>.</p></div></section><section id="_différentes_catégories_de_test"><h2>Différentes catégories de test</h2><div class="ulist"><ul><li><p>Tests unitaires : valide une partie très spécifique de l&#8217;application, en général une classe ou une méthode. On simule parfois l&#8217;environnement du code à tester (<em>mock</em>).</p></li><li><p>Tests d&#8217;intégration : on valide le comportement de l&#8217;application dans son ensemble. On <em>déploie</em> l&#8217;application dans un environnement conforme à la production et on teste par les <em>bouts</em>.</p></li><li><p>Tests de performance : s&#8217;assurer des bonnes performances de l&#8217;application (<em>throughput</em>, <em>req/s</em>, &#8230;&#8203;).</p></li></ul></div>
<div class="paragraph"><p>On distingue deux autres catégories : tests d'<em>état</em> et tests <em>comportementaux</em>.</p></div></section><section id="_outils_pour_les_tests"><h2>Outils pour les tests</h2><div class="paragraph"><p>JUnit</p></div>
<div class="paragraph"><p>TestNG</p></div></section><section id="_junit"><h2>JUnit</h2><div class="paragraph"><p>junit.org</p></div>
<div class="paragraph"><p>Dépôt <a href="https://github.com/junit-team/junit">Git Hub</a>.</p></div></section><section id="_exemple_6"><h2>Exemple</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public class MyTests {
    @Test
    public void multiplicationOfZeroIntegersShouldReturnZero() {
        MyClass tester = new MyClass(); // MyClass is tested

        // assert statements
        assertEquals("10 x 0 must be 0", 0, tester.multiply(10, 0));
        assertEquals("0 x 10 must be 0", 0, tester.multiply(0, 10));
        assertEquals("0 x 0 must be 0", 0, tester.multiply(0, 0));
    }
}</code></pre></div></div></section><section id="_conventions"><h2>Conventions</h2><div class="paragraph"><p>Les classes de test pour un projet <em>maven</em> se trouvent dans <code>src/test/java</code>.
Les resources de test dans <code>src/test/resources</code>.</p></div>
<div class="paragraph"><p>Il est courant d&#8217;ajouter le suffixe <code>Test</code> aux noms des classes de tests.
Maven utilise cette convention pour exécuter automatiquement les tests se trouvant dans le bon répertoire.</p></div>
<div class="paragraph"><p>Pour un projet maven, c&#8217;est le plugin <code>surefire</code> qui est en charge des tests (dans la phase <em>test</em>).</p></div></section><section id="_junit_4_annotations"><h2>JUnit 4 - Annotations</h2><div class="paragraph"><p>Un ensemble d&#8217;annotations (package <code>org.junit</code>) est utilisé pour configurer une classe de test :</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Annotation</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Test</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Identifie une méthode de test</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Before</code>, <code>@After</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Méthode exécutée avant et après chaque test</p></td></tr></tbody></table></section><section id="_annotations"><h2>Annotations</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>@BeforeClass</code>, <code>@AfterClass</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Méthode exécutée avant et après l&#8217;initialisation de la classe de tests. Doivent être <em>statique</em>.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Ignore</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ignore un test</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Test(expected=SQLException.class)</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Le test échoue si l&#8217;exception n&#8217;est pas levée</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Test(timeout=100)</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Le test échoue s&#8217;il ne termine pas en moins de 100ms.</p></td></tr></tbody></table></section><section id="_assertions"><h2>Assertions</h2><div class="paragraph"><p>Pour valider un test, on utilise les assertions de JUnit. Une assertion non validée dans un test positionne le test en échec.</p></div>
<div class="paragraph"><p>Les assertions de JUnit sont des méthodes statiques de la classe <code>org.junit.Assert</code>.</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Méthode</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>fail(message)</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Fait échouer le test</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>assertTrue(message, condition)</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vérifie que <code>condition</code> est vrai</p></td></tr></tbody></table></section><section id="_assertions_2"><h2>Assertions</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Méthode</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>assertFalse(&#8230;&#8203;)</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vérifie que la condition est fausse</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>assertEquals(message, expected, actual)</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Vérifie que <code>actual</code> est égal à <code>expected</code></p></td></tr></tbody></table>
<div class="paragraph"><p><code>assertSame()</code>, <code>assertNotSame()</code>, <code>assertNull()</code>, <code>assertNotNull()</code>&#8230;&#8203;</p></div></section><section id="_utilisation_avec_maven"><h2>Utilisation avec Maven</h2><div class="paragraph"><p>Le framework JUnit est disponible sur Maven Central :</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>&lt;dependency&gt;
    &lt;groupId&gt;junit&lt;/groupId&gt;
    &lt;artifactId&gt;junit&lt;/artifactId&gt;
    &lt;version&gt;4.12&lt;/version&gt;
	&lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></div></div></section><section id="_exemple_7"><h2>Exemple</h2><div class="paragraph"><p>Voici un <a href="http://www.vogella.com/tutorials/JUnit/article.html#exercise-using-junit">exemple</a> de mise en place de test unitaire.</p></div></section><section id="_mocking"><h2>Mocking</h2><div class="paragraph"><p>Parfois, il n&#8217;est pas possible d&#8217;isoler complètement une classe du reste de l&#8217;application (tout est lié).</p></div>
<div class="paragraph"><p>On a alors recours à des outils de <em>mock</em> qui permettent de remplacer les dépendances du code à tester
par des <em>bouchons</em> simulant l&#8217;environnement du test (voir le framework <a href="http://site.mockito.org/">Mockito</a>).</p></div></section><section id="_tests_d_intégration"><h2>Tests d&#8217;intégration</h2><div class="paragraph"><p>Ceux-ci sont les plus difficiles à mettre en place car il faut <em>déployer</em>
l&#8217;application dans un environnement <em>équivalent</em> à celui de production (base de donnée, configuration, clustering, &#8230;&#8203;).</p></div></section><section id="_arquillian"><h2>Arquillian</h2><div class="paragraph"><p><em>Arquillian</em> (<a href="http://arquillian.org/invasion/">site</a>) est un outil qui facilite la mise en place des tests d&#8217;intégration :</p></div>
<div class="ulist"><ul><li><p>Gère le lancement et l&#8217;arrêt d&#8217;un AS complet.</p></li><li><p>Produit une archive contenant le code à tester à la volée.</p></li><li><p>Déploie l&#8217;archive dans le conteneur de test.</p></li><li><p>Exécute les tests d&#8217;intégration.</p></li><li><p>Produit un rapport d&#8217;exécution.</p></li></ul></div>
<div class="paragraph"><p>S&#8217;intègre à <code>JUnit</code> et <code>TestNG</code>.</p></div>
<div class="paragraph"><p>Avantanges : on n&#8217;a plus besoin de mocker les dépendances, tout est en place !</p></div>
<div class="paragraph"><p>Inconvénients : lent puisque qu&#8217;on bootstrappe tout l&#8217;environnement de l&#8217;application.</p></div></section><section id="_exemple_8"><h2>Exemple</h2><div class="paragraph"><p>Voici un <a href="http://arquillian.org/guides/testing_java_persistence/">guide</a> de mise en place de test d&#8217;intégration avec
Arquillian. On lance un Wildfly embarqué pour être 'iso-prod'.</p></div>
<div class="paragraph"><p>Voir ce <a href="https://github.com/ltearno/BibliothequeAudio">projet</a> pour un exemple concret de mise en place.</p></div></section><section id="_tests_de_performance"><h2>Tests de performance</h2><div class="paragraph"><p>S&#8217;assurer des bonnes performances de l&#8217;application :</p></div>
<div class="ulist"><ul><li><p>nombre de requêtes par seconde,</p></li><li><p>latence,</p></li><li><p>capacité de traitement,&#8230;&#8203;</p></li></ul></div>
<div class="paragraph"><p>Exemple d&#8217;outil : gatling.io[Gatling].</p></div></section><section id="_couverture_de_code"><h2>Couverture de code</h2><div class="paragraph"><p>En général on veut s&#8217;assurer que l&#8217;ensemble des tests (unitaires et intégration) couvrent l&#8217;ensemble du code applicatif.</p></div>
<div class="paragraph"><p>Exemple : mettre en place <a href="http://site.mockito.org/">Mockito</a>.</p></div></section></section>
<section><section id="_cdi"><h2>CDI</h2><div class="paragraph"><p>Contextual Dependency Injection</p></div><div class="paragraph"><p>Pour fonctionner un composant a besoin d&#8217;autres composants, ceux sont ses <em>dépendances</em>.</p></div><div class="paragraph"><p>Les composants ne sont plus responsables de récupérer ces dépendances (eg. instances, services statiques, etc&#8230;&#8203;) car c&#8217;est l&#8217;outil de <em>gestion des dépendances</em> qui s&#8217;en charge pour eux.</p></div><div class="paragraph"><p><code>Weld</code> est l&#8217;implémentation de référence de la norme CDI, réalisé par <em>RedHat</em>.</p></div><div class="paragraph"><p>Java EE 6, CDI 1.0, Weld 1.1
Java EE 7, CDI 1.2, Weld 2.4
JAVA EE 8, CDI 2.0, Weld 3.0</p></div><div class="paragraph"><p>Pour JBoss, la dépendance Maven est la suivante :</p></div><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">&lt;groupId&gt;javax.enterprise&lt;/groupId&gt;
	&lt;artifactId&gt;cdi-api&lt;/artifactId&gt;
	&lt;!-- Use version 2.0 for Weld 3 --&gt;
	&lt;version&gt;1.2&lt;/version&gt;
	&lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></div></div><div class="paragraph"><p>Doc : <a href="https://docs.jboss.org/weld/reference/1.0.0/en-US/html/beanscdi.html" class="bare">https://docs.jboss.org/weld/reference/1.0.0/en-US/html/beanscdi.html</a></p></div><div class="paragraph"><p>===</p></div><div class="paragraph"><p>Beans sans constructeur par défaut sont toujours des bean si le constructeur est annoté avec <code>@Inject</code></p></div><div class="paragraph"><p>Annotation <code>@Inject</code> : applicable à un constructeur, méthode ou attribut pour déclencher l&#8217;injection
de dépendance et indiquer à CDI d&#8217;utiliser ce constructeur pour créer les instances de ce bean.</p></div><div class="paragraph"><p>Le conteneur CDI choisit l&#8217;objet à injecter en fonction du type du point d&#8217;injection et ne prend pas
en compte le nom du champ, de la méthode ou du paramètre.</p></div></section><section id="_définition_du_bean"><h2>Définition du bean</h2><div class="ulist"><ul><li><p>classe qui contient de la logique applicative,</p></li><li><p>appelé directement depuis du code Java, ou bien depuis des expressions EL,</p></li><li><p>a accès aux ressources transactionnelles,</p></li><li><p>les dépendances entre beans sont gérées par le conteneur d&#8217;application,</p></li><li><p>la plupart des beans sont <em>stateful</em> et <em>contextuels</em>,</p></li><li><p>son cycle de vie est géré par le conteneur.</p></li></ul></div>
<div class="paragraph"><p>Important : <strong>contextuel</strong> et <strong>cycle de vie géré par l&#8217;AS</strong>.</p></div></section><section id="_définition_3"><h2>Définition</h2><div class="paragraph"><p>Plus formellement :</p></div>
<div class="paragraph"><p>A bean comprises the following attributes:</p></div>
<div class="ulist"><ul><li><p>A (nonempty) set of bean types</p></li><li><p>A (nonempty) set of qualifiers</p></li><li><p>A scope</p></li><li><p>Optionally, a bean EL name</p></li><li><p>A set of interceptor bindings</p></li><li><p>A bean implementation</p></li></ul></div></section><section id="_types_du_bean"><h2>Types du bean</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="java language-java">public class BookShop
      extends Business
      implements Shop&lt;Book&gt;
{
   ...
}</code></pre></div></div>
<div class="paragraph"><p>Cette classe a quatre types au sens CDI : <code>BookShop</code>, <code>Business</code>, <code>Shop&lt;Book&gt;</code> et <code>Object</code>.</p></div></section></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'beige',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>